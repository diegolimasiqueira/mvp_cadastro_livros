# üìö Sistema de Cadastro de Livros

Sistema completo de gerenciamento de livros desenvolvido com **.NET 9** e **Angular v20**, seguindo os princ√≠pios de **Clean Architecture** e boas pr√°ticas de desenvolvimento.

## üèóÔ∏è Arquitetura

### Backend (.NET 9)
- **Clean Architecture** com separa√ß√£o em camadas:
  - **Domain**: Entidades e interfaces de dom√≠nio
  - **Application**: DTOs, valida√ß√µes e servi√ßos de aplica√ß√£o
  - **Infrastructure**: Acesso a dados, reposit√≥rios e migrations
  - **API**: Controllers e configura√ß√µes da API REST

- **Tecnologias**:
  - Entity Framework Core 9.0 com PostgreSQL
  - FluentValidation para valida√ß√£o de DTOs
  - JWT para autentica√ß√£o
  - Swagger/OpenAPI para documenta√ß√£o da API
  - QuestPDF para gera√ß√£o de relat√≥rios em PDF
  - EPPlus para gera√ß√£o de relat√≥rios em Excel

### Frontend (Angular v20)
- **Standalone Components** com Signals para reatividade
- **ng-bootstrap** para componentes de UI
- **Interceptors** para autentica√ß√£o JWT
- **Guards** para prote√ß√£o de rotas
- Layout responsivo com menu colaps√°vel

## üìã Funcionalidades

### Gest√£o de Entidades
- ‚úÖ **Livros**: CRUD completo com m√∫ltiplos autores, assuntos e pre√ßos por forma de compra
- ‚úÖ **Autores**: Cadastro e gerenciamento de autores
- ‚úÖ **Assuntos**: Categoriza√ß√£o de livros por assunto
- ‚úÖ **Formas de Compra**: Defini√ß√£o de canais de venda (Internet, Balc√£o, etc.)

### Relat√≥rios
- ‚úÖ **Relat√≥rio de Livros por Autor**:
  - Visualiza√ß√£o HTML com agrupamento por autor
  - Pagina√ß√£o em dois n√≠veis (autores e livros)
  - Filtros din√¢micos por todos os campos
  - Exporta√ß√£o para PDF e Excel
  - VIEW otimizada no PostgreSQL para performance

### Valida√ß√µes
- ‚úÖ Valida√ß√£o completa de dados no backend e frontend
- ‚úÖ Feedback visual imediato para erros de valida√ß√£o
- ‚úÖ Mensagens de erro claras e objetivas

## üöÄ Executando o Projeto

### Pr√©-requisitos
- Docker e Docker Compose
- (Opcional para execu√ß√£o local) .NET 9 SDK, Node.js 22+, PostgreSQL 16+

### Com Docker (Recomendado)

1. **Clone o reposit√≥rio**:
```bash
git clone <url-do-repositorio>
cd mvp_cadastro_livros
```

2. **Inicie todos os servi√ßos**:
```bash
docker compose up -d
```

3. **Acesse a aplica√ß√£o**:
   - Frontend: http://localhost:3000
   - Backend (Swagger): http://localhost:8080/swagger
   - PostgreSQL: localhost:5433 (mapeado do container 5432)

4. **Credenciais padr√£o**:
   - Usu√°rio: `admin`
   - Senha: `Admin@123`

5. **Autentica√ß√£o no Swagger**:
   - Acesse http://localhost:8080/swagger
   - Use o endpoint `/api/Auth/login` com as credenciais acima para obter o token JWT
   - Clique no bot√£o **Authorize** (cadeado verde no topo da p√°gina)
   - Cole o token no campo (n√£o precisa adicionar "Bearer", ser√° adicionado automaticamente)
   - Clique em **Authorize** e depois **Close**
   - Agora voc√™ pode testar todos os endpoints protegidos

6. **Parar os servi√ßos**:
```bash
docker compose down
```

7. **Conectar ao PostgreSQL com pgAdmin ou outro cliente**:
   - **Host**: `localhost`
   - **Porta**: `5433`
   - **Database**: `bookstoredb`
   - **Usu√°rio**: `postgres`
   - **Senha**: `postgres123`

8. **Resetar o ambiente (limpar banco de dados)**:
```bash
docker compose down -v
docker compose up -d
```

### Execu√ß√£o Local (Sem Docker)

#### Backend

**Pr√©-requisitos**: .NET 9 SDK, PostgreSQL 16+

1. **Instale o PostgreSQL 16+** (se ainda n√£o tiver):
```bash
# Ubuntu/Debian
sudo apt install postgresql-16

# macOS
brew install postgresql@16

# Windows
# Baixe o instalador em: https://www.postgresql.org/download/windows/
```

2. **Crie o banco de dados**:
```bash
# M√©todo 1: Via psql
psql -U postgres
CREATE DATABASE bookstoredb;
\q

# M√©todo 2: Via createdb
createdb -U postgres bookstoredb

# M√©todo 3: Via pgAdmin
# Abra o pgAdmin, clique com bot√£o direito em "Databases" ‚Üí "Create" ‚Üí "Database"
# Nome: bookstoredb
```

3. **Configure suas credenciais locais**:
```bash
cd backend/src/BookStore.API

# Edite o arquivo appsettings.Development.json
# Ajuste APENAS a senha na ConnectionString para sua senha local do PostgreSQL
nano appsettings.Development.json  # ou use seu editor preferido (VS Code, vim, etc.)
```

Exemplo do conte√∫do do `appsettings.Development.json`:
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Host=localhost;Port=5432;Database=bookstoredb;Username=postgres;Password=SUA_SENHA_AQUI"
  },
  ...
}
```

> ‚ö†Ô∏è **IMPORTANTE - Seguran√ßa**: 
> - **NUNCA commit o `appsettings.Development.json` com sua senha pessoal!**
> - Antes de fazer commit, **reverta a senha para `postgres123`** (senha padr√£o do Docker).
> - Este arquivo est√° configurado com a senha padr√£o do reposit√≥rio para facilitar execu√ß√£o com Docker.
> - Para seu ambiente local, voc√™ ajusta a senha temporariamente, mas **n√£o deve committ√°-la**.

4. **Instale a ferramenta EF Core CLI** (se n√£o tiver):
```bash
dotnet tool install --global dotnet-ef
# Ou atualize se j√° tiver: dotnet tool update --global dotnet-ef
```

5. **Execute as migrations** (cria todas as tabelas e VIEW automaticamente):
```bash
cd backend

# Passe a connection string diretamente (mais confi√°vel que appsettings)
# Substitua "SUA_SENHA_AQUI" pela senha do seu PostgreSQL local
dotnet ef database update \
  --project src/BookStore.Infrastructure \
  --startup-project src/BookStore.API \
  --connection "Host=localhost;Port=5432;Database=bookstoredb;Username=postgres;Password=SUA_SENHA_AQUI"

# Exemplo com senha "Master@123":
# dotnet ef database update --project src/BookStore.Infrastructure --startup-project src/BookStore.API --connection "Host=localhost;Port=5432;Database=bookstoredb;Username=postgres;Password=Master@123"
```

**O que a migration faz automaticamente:**
- ‚úÖ Criar todas as tabelas (Livro, Autor, Assunto, FormaCompra)
- ‚úÖ Criar os relacionamentos (Livro_Autor, Livro_Assunto, LivroPreco)
- ‚úÖ Criar a VIEW (vw_livros_por_autor) para relat√≥rios
- ‚úÖ Inserir dados iniciais (usu√°rio admin com senha Admin@123)

6. **Execute a API**:
```bash
cd backend/src/BookStore.API

# A API usar√° automaticamente o appsettings.Development.json
# (com a senha que voc√™ configurou no passo 3)
dotnet run
```

A API estar√° dispon√≠vel em **http://localhost:8080** (a porta pode variar, verifique o console)
- **Swagger UI**: http://localhost:8080/swagger (ou a porta exibida no console)
- **Health Check**: http://localhost:8080/health

**Comandos √∫teis para gerenciar o banco de dados local**:

> **üí° Dica:** Para todos os comandos abaixo, voc√™ pode precisar passar o par√¢metro `--connection` com sua connection string, caso o `dotnet ef` CLI n√£o carregue automaticamente o `appsettings.Development.json`.

```bash
cd backend

# Verificar migrations pendentes
dotnet ef migrations list \
  --project src/BookStore.Infrastructure \
  --startup-project src/BookStore.API

# Criar uma nova migration (se necess√°rio)
dotnet ef migrations add NomeDaMigration \
  --project src/BookStore.Infrastructure \
  --startup-project src/BookStore.API

# Reverter a √∫ltima migration (passe --connection se necess√°rio)
dotnet ef database update NomeMigrationAnterior \
  --project src/BookStore.Infrastructure \
  --startup-project src/BookStore.API

# Remover a √∫ltima migration (se ainda n√£o foi aplicada)
dotnet ef migrations remove \
  --project src/BookStore.Infrastructure \
  --startup-project src/BookStore.API

# Resetar o banco de dados (DROP + CREATE + Migrations)
dotnet ef database drop --force \
  --project src/BookStore.Infrastructure \
  --startup-project src/BookStore.API \
  --connection "Host=localhost;Port=5432;Database=bookstoredb;Username=postgres;Password=SUA_SENHA"

dotnet ef database update \
  --project src/BookStore.Infrastructure \
  --startup-project src/BookStore.API \
  --connection "Host=localhost;Port=5432;Database=bookstoredb;Username=postgres;Password=SUA_SENHA"
```

#### Frontend

**Pr√©-requisitos**: Node.js 22+, npm

1. **Instale o Node.js 22+** (se ainda n√£o tiver):
```bash
# Ubuntu/Debian (usando nvm - recomendado)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 22
nvm use 22

# macOS
brew install node@22

# Windows
# Baixe o instalador em: https://nodejs.org/
```

2. **Instale as depend√™ncias**:
```bash
cd frontend
npm install --legacy-peer-deps
```

3. **Configure a URL da API** (se necess√°rio):
```typescript
// frontend/src/app/services/api.service.ts
// A URL padr√£o j√° est√° configurada para http://localhost:5000/api
// Altere apenas se sua API estiver em outra porta

private API_URL = 'http://localhost:5000/api';
```

4. **Execute o frontend**:
```bash
npm start

# Ou em modo de desenvolvimento com reload autom√°tico:
ng serve
```

O frontend estar√° dispon√≠vel em http://localhost:4200

**Nota**: Certifique-se de que o backend est√° rodando antes de iniciar o frontend.

## üß™ Testes e Cobertura

### Backend

O projeto possui testes unit√°rios e de integra√ß√£o com cobertura m√≠nima de 80%.

#### Executar todos os testes:
```bash
cd backend
dotnet test
```

#### Gerar relat√≥rio de cobertura:
```bash
cd backend

# 1. Executar testes com cobertura
dotnet test --settings coverlet.runsettings --collect:"XPlat Code Coverage" --results-directory ./TestResults

# 2. Gerar relat√≥rio HTML
reportgenerator -reports:"TestResults/**/coverage.cobertura.xml" \
                 -targetdir:"TestResults/CoverageReport" \
                 -reporttypes:"Html;Cobertura"

# 3. Visualizar relat√≥rio
cd TestResults/CoverageReport
python3 -m http.server 8081
# Acesse: http://localhost:8081
```

#### Executar apenas testes unit√°rios:
```bash
cd backend
dotnet test tests/BookStore.UnitTests/BookStore.UnitTests.csproj
```

#### Executar apenas testes de integra√ß√£o:
```bash
cd backend
dotnet test tests/BookStore.IntegrationTests/BookStore.IntegrationTests.csproj
```

### Frontend

O projeto possui testes com cobertura m√≠nima de 70%.

#### Executar todos os testes:
```bash
cd frontend
npm test
```

#### Gerar relat√≥rio de cobertura:
```bash
cd frontend

# 1. Executar testes com cobertura
npm run test:coverage

# 2. Visualizar relat√≥rio
cd coverage/frontend
python3 -m http.server 8082
# Acesse: http://localhost:8082
```

#### Executar testes em modo watch (desenvolvimento):
```bash
cd frontend
npm test -- --watch
```

## üîå Conectando ao Banco de Dados

### Usando pgAdmin

1. **Abra o pgAdmin** e crie uma nova conex√£o
2. **Configura√ß√µes da conex√£o**:
   ```
   General:
     Name: BookStore Docker
   
   Connection:
     Host: localhost
     Port: 5433
     Maintenance database: bookstoredb
     Username: postgres
     Password: postgres123
   
   SSL:
     SSL mode: Prefer
   ```

3. **Salve e conecte**

### Usando DBeaver, DataGrip ou outra ferramenta

Use as mesmas configura√ß√µes:
- **Driver**: PostgreSQL
- **Host**: localhost
- **Port**: 5433
- **Database**: bookstoredb
- **User**: postgres
- **Password**: postgres123

### Via linha de comando (psql)

```bash
# Com psql instalado localmente
psql -h localhost -p 5433 -U postgres -d bookstoredb

# Ou usando o container Docker
docker exec -it bookstore-postgres psql -U postgres -d bookstoredb
```

## üóÑÔ∏è Estrutura do Banco de Dados

### üìä Diagrama Entidade-Relacionamento

Para visualizar o diagrama completo da modelagem de dados, acesse: **[DATABASE_SCHEMA.md](DATABASE_SCHEMA.md)**

O diagrama Mermaid ser√° renderizado automaticamente no GitHub com todas as tabelas, relacionamentos e cardinalidades.

### Tabelas Principais
- **Livro**: Informa√ß√µes b√°sicas dos livros
- **Autor**: Cadastro de autores
- **Assunto**: Categorias de assuntos
- **FormaCompra**: Canais de venda
- **Livro_Autor**: Relacionamento N:N entre livros e autores
- **Livro_Assunto**: Relacionamento N:N entre livros e assuntos
- **LivroPreco**: Pre√ßos por forma de compra

### VIEW para Relat√≥rios
- **vw_livros_por_autor**: VIEW otimizada com dados agregados para gera√ß√£o de relat√≥rios

## üìä Estrutura de Diret√≥rios

```
mvp_cadastro_livros/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BookStore.API/          # Controllers e Program.cs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BookStore.Application/  # DTOs, Services, Validators
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BookStore.Domain/       # Entities e Interfaces
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BookStore.Infrastructure/# Repositories e Data
‚îÇ   ‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BookStore.UnitTests/    # Testes unit√°rios
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BookStore.IntegrationTests/ # Testes de integra√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ coverlet.runsettings        # Configura√ß√£o de cobertura
‚îÇ   ‚îî‚îÄ‚îÄ BookStore.sln
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/         # Componentes da aplica√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/           # Servi√ßos (API, Auth)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guards/             # Guards de rota
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ interceptors/       # HTTP Interceptors
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models/             # Interfaces TypeScript
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ styles.scss
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ nginx.conf
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ README.md
```

## üîß Tecnologias Utilizadas

### Backend
- .NET 9.0
- Entity Framework Core 9.0
- PostgreSQL 16
- FluentValidation 11.x
- Swashbuckle (Swagger) 9.x
- xUnit + Moq + FluentAssertions
- Testcontainers
- Coverlet
- QuestPDF 2024.10
- EPPlus 7.5

### Frontend
- Angular 20
- TypeScript 5.7
- ng-bootstrap 19
- Bootstrap 5.3
- RxJS 7.8
- Jasmine + Karma

### DevOps
- Docker & Docker Compose
- Multi-stage builds
- Health checks

## üìù Endpoints da API

### Autentica√ß√£o
- `POST /api/auth/login` - Login de usu√°rio

### Livros
- `GET /api/livros` - Listar livros (com pagina√ß√£o)
- `GET /api/livros/{id}` - Buscar livro por ID
- `POST /api/livros` - Criar livro
- `PUT /api/livros/{id}` - Atualizar livro
- `DELETE /api/livros/{id}` - Deletar livro

### Autores
- `GET /api/autores` - Listar autores (com pagina√ß√£o)
- `GET /api/autores/{id}` - Buscar autor por ID
- `POST /api/autores` - Criar autor
- `PUT /api/autores/{id}` - Atualizar autor
- `DELETE /api/autores/{id}` - Deletar autor

### Assuntos
- `GET /api/assuntos` - Listar assuntos (com pagina√ß√£o)
- `GET /api/assuntos/{id}` - Buscar assunto por ID
- `POST /api/assuntos` - Criar assunto
- `PUT /api/assuntos/{id}` - Atualizar assunto
- `DELETE /api/assuntos/{id}` - Deletar assunto

### Formas de Compra
- `GET /api/formascompra` - Listar formas de compra (com pagina√ß√£o)
- `GET /api/formascompra/{id}` - Buscar forma de compra por ID
- `POST /api/formascompra` - Criar forma de compra
- `PUT /api/formascompra/{id}` - Atualizar forma de compra
- `DELETE /api/formascompra/{id}` - Deletar forma de compra

### Relat√≥rios
- `GET /api/reports/books-by-author` - Obter dados do relat√≥rio (JSON)
- `GET /api/reports/books-by-author/pdf` - Baixar relat√≥rio em PDF
- `GET /api/reports/books-by-author/excel` - Baixar relat√≥rio em Excel

## üõ°Ô∏è Seguran√ßa

- Autentica√ß√£o via JWT
- Prote√ß√£o de rotas no frontend via Guards
- Interceptor HTTP para anexar token automaticamente
- Valida√ß√£o de dados no backend e frontend
- Tratamento global de exce√ß√µes

### ‚ö†Ô∏è Nota Importante sobre Credenciais

**Este √© um projeto de demonstra√ß√£o/desafio t√©cnico.** Por isso, as credenciais e secrets est√£o **hardcoded** nos arquivos `appsettings.json` para facilitar a avalia√ß√£o e execu√ß√£o do projeto.

**Em um ambiente de produ√ß√£o, NUNCA fa√ßa isso!** As boas pr√°ticas incluem:

#### ‚úÖ **O que fazer em produ√ß√£o:**

1. **Usar Gerenciadores de Secrets**:
   - Azure Key Vault
   - AWS Secrets Manager
   - HashiCorp Vault
   - Google Cloud Secret Manager

2. **Vari√°veis de Ambiente**:
   ```bash
   # Exemplo no docker-compose.yml
   environment:
     - ConnectionStrings__DefaultConnection=${DB_CONNECTION_STRING}
     - JwtSettings__SecretKey=${JWT_SECRET_KEY}
   ```

3. **Docker Secrets** (Docker Swarm):
   ```yaml
   secrets:
     db_password:
       external: true
   ```

4. **Kubernetes Secrets**:
   ```yaml
   apiVersion: v1
   kind: Secret
   metadata:
     name: db-credentials
   type: Opaque
   data:
     password: <base64-encoded>
   ```

5. **Adicionar ao `.gitignore`**:
   ```gitignore
   appsettings.json
   appsettings.*.json
   !appsettings.Development.json.example
   ```

#### ‚ùå **O que N√ÉO fazer (mas fizemos aqui para facilitar):**
- ‚ùå Commitar connection strings
- ‚ùå Commitar JWT secret keys
- ‚ùå Commitar senhas no c√≥digo
- ‚ùå Usar credenciais padr√£o em produ√ß√£o

#### üìù **Arquivos com credenciais neste projeto:**
- `backend/src/BookStore.API/appsettings.json` - Connection string (Docker) e JWT secret
- `backend/src/BookStore.API/appsettings.Development.json` - Connection string (Local com senha padr√£o `postgres123`)
- `docker-compose.yml` - Senha do PostgreSQL

**Estes arquivos foram commitados propositalmente apenas para facilitar a execu√ß√£o e avalia√ß√£o deste desafio t√©cnico.**

> üí° **Para desenvolvimento local**: O `appsettings.Development.json` est√° configurado com a senha padr√£o `postgres123`. Se voc√™ alterar para sua senha local, **lembre-se de reverter antes de fazer commit!**

## üì¶ Build para Produ√ß√£o

### Docker (Recomendado)
```bash
# Build e deploy com Docker Compose
docker compose up -d --build
```

### Manual

#### Backend
```bash
cd backend/src/BookStore.API
dotnet publish -c Release -o ./publish
```

#### Frontend
```bash
cd frontend
npm run build
# Os arquivos estar√£o em frontend/dist/frontend/browser/
```

## ü§ù Contribuindo

1. Fa√ßa um fork do projeto
2. Crie uma branch para sua feature (`git checkout -b feature/MinhaFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Adiciona MinhaFeature'`)
4. Push para a branch (`git push origin feature/MinhaFeature`)
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT.

## üë®‚Äçüíª Autor

Desenvolvido para o desafio de cadastro de livros.
